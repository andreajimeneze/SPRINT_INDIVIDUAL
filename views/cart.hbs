{{#> template}}

<main>
    <div class="cartTable">
        <h4 id="cart-title">Canasta de compras</h4>
        <table class="cart">
            <thead class="thead-cart">
                <tr id="headTitleCart">
                    <th>ID</th>
                    <th>Imagen</th>
                    <th>Nombre</th>
                    <th>Precio</th>
                    <th>Cantidad</th>
                    <th>Subtotal</th>
                    <th>Acciones</th>
                </tr>
            </thead>

            {{#each canasta }}
            <tbody>

                <tr class="table-row">
                    <td> {{ id }}</td>
                    <td><img src="{{foto}}" alt="" id="img-cart"></td>
                    <td>{{ nombre }}</td>
                    <form action="/cart/subtotal" method="post">
                        <td id="precioPdto_{{ id }}" name="prize">{{ precio}}</td>
                        <td id="cantPdto">
                            <button class="btn btn-info bton-card" id="btn-minus" name="btnMinus"
                                value="{{ id }}">-</button>
                                <input type="hidden" name="cantProd" value="{{ cant }}" id="cant_{{ id }}">
                            <p class="mb-0 mt-2 align-self:center cantProdDisplay" id="cant_{{ id }}">{{ cant }}</p>
                            <button class="btn btn-info bton-card" id="btn-plus" name="btnAdd" value="{{ id }}">+</button>
                        </td>
                        <td class="subtotalPdto_{{ id }}">{{ subtotal }}</td>
                    </form>
                    <td>
                        <form action="/cart/{{ id}}?_method=DELETE" method="post">
                            <input type="hidden" name="id">
                            <button class="trash-btn" id="{{id}}"></button>
                        </form>
                    </td>
                </tr>
            </tbody>
            {{/each}}

            <tfoot>
                <tr>
                    <td colspan="4">Total:</td>
                    <td>{{precio}}</td>
            </tfoot>

        </table>

        <form action="/cart/?_method=DELETE" method="post">
            <button class="btn btn-primary" name="vaciar">Vaciar</button>
        </form>

        <button class="btn btn-primary" onclick="window.location.href='/tienda'">Volver a comprar</button>
    </div>
</main>
<script>
    const btnAdd = document.querySelectorAll("#btn-plus");
    const btnMinus = document.querySelectorAll("#btn-minus");

    btnAdd.forEach((btn) => {
        btn.addEventListener("click", () => {
            let cantProd = btn.parentNode.querySelector(".cantProdDisplay");

            let cantActual = parseInt(cantProd.textContent);
            if (cantActual > 0) {
                let newCant = cantActual + 1;
                cantProd.textContent = newCant.toString();
                console.log(newCant);
                console.log(cantProd);
                console.log(cantActual);
            }
        });
    }),

        btnMinus.forEach((btn) => {
            btn.addEventListener("click", () => {
                let cantProd = btn.parentNode.querySelector(".cantProdDisplay");

                let cantActual = parseInt(cantProd.textContent);
                if (cantActual > 1) {
                    let newCant = cantActual - 1;
                    cantProd.textContent = newCant.toString();
                    console.log(newCant);
                    console.log(cantProd);
                    console.log(cantActual);
                }
            });
        });
</script>

{{/template}}